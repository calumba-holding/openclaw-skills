# Smart Router - 4D 压缩智能分发器

**版本：** 1.3（配置驱动修复版）  
**创建时间：** 2026-02-24  
**修复时间：** 2026-02-25 07:25  
**作者：** Neo（宇宙神经系统）  
**审核：** 指挥官 (Morpheus) + 工程师 Grok（第三方审计）

---

## 📋 技能描述

**一句话定义：**
> "用户一键发送，系统自动选择最优压缩版本，无感智能路由。"

**核心功能：**
- 自动识别文本类型（哲学/项目/技术/对话/情感/数据）
- 智能路由到最优 4D 压缩版本（A/B/C）
- 显示智能徽章，让用户感知系统智能
- 零额外 Token 消耗（规则匹配，非 AI 判断）

**触发词：**
- `/compress` - 开始压缩
- `/4d` - 快捷压缩
- `开始压缩` - 中文触发

---

## 🏗️ 架构设计（三层结构）

### **第一层：极速嗅探器（输入预判层）**

**功能：** 1 秒内为输入文本打标签

**实现方式：**
- 极轻量规则（长度 + 特征词）
- 不调用大模型，避免 Token 消耗
- 正则表达式 + 关键词匹配

**嗅探维度：**
| 维度 | 判断标准 | 权重 |
|------|----------|------|
| **长度** | <2k / 2k-10k / >10k tokens | 高 |
| **情感** | 表情符号/情感词汇 | 中 |
| **问题** | 问号/疑问词 | 中 |
| **结构** | 数字列表/因此/总结/架构/数据 | 高 |
| **知识** | 理论/框架/概念/定义 | 高 |

---

### **第二层：动态路由网关（核心决策层）**

**功能：** 根据嗅探结果，自动分发到最优版本

**路由规则：**

```javascript
if (长度 < 2000 && (有问号 || 有情感)) {
    return "版本 A"; // 对话/情感类 → 原版四力
} else if (有结构词) {
    return "版本 B"; // 数据/查询类 → S-E-I-T
} else {
    return "版本 C"; // 知识/深度/默认 → 混合版
}
```

**详细规则：**

| 文本类型 | 特征 | 路由版本 | 徽章 |
|----------|------|----------|------|
| **对话记录** | 问号 + 短文本 | A | ⚡️ 灵动模式 |
| **情感反思** | 情感词 + 表情 | A | ⚡️ 灵动模式 |
| **数据报告** | 结构词 + 数字 | B | 📋 结构模式 |
| **技术文档** | 架构/系统/模块 | B | 📋 结构模式 |
| **哲学理论** | 理论/框架/概念 | C | 🧠 深度无损 |
| **项目日志** | 任务/完成/待办 | C | 🧠 深度无损 |
| **知识学习** | 学习/理解/掌握 | C | 🧠 深度无损 |
| **默认** | 无法分类 | C | 🧠 深度无损 |

---

### **第三层：前端表现层（用户体验层）**

**功能：** 极简交互 + 智能徽章显示

**输入界面：**
```
┌─────────────────────────────────────┐
│  📄 拖拽文件或粘贴文本              │
│                                     │
│  [开始压缩]                         │
└─────────────────────────────────────┘
```

**输出徽章：**
- 版本 A → `[⚡️ 灵动模式]`
- 版本 B → `[📋 结构模式]`
- 版本 C → `[🧠 深度无损模式]`

**输出示例：**
```
🧠 深度无损模式 | 节省 63% | 语义保留 97%

# 4D 压缩结果

【选择力】...
【影响力】...
【反馈力】...
【体验力】...
```

---

## 📁 文件结构

```
smart-router/
├── SKILL.md           # 技能定义（本文件）
├── router.js          # 主路由逻辑
├── sniff-rules.json   # 嗅探规则配置
├── badge-config.json  # 徽章显示配置
└── logs/              # 路由日志目录
    └── router-YYYYMMDD.log
```

---

## 🔧 配置说明

### **sniff-rules.json**

```json
{
  "versionA": {
    "maxLength": 2000,
    "hasQuestion": true,
    "hasEmotion": true,
    "keywords": ["我觉得", "我感觉", "怎么办", "为什么", "好难过", "好开心"]
  },
  "versionB": {
    "structureWords": ["因此", "总结", "架构", "数据", "分析", "报告", "统计"],
    "hasNumberList": true
  },
  "versionC": {
    "knowledgeWords": ["理论", "框架", "概念", "定义", "原理", "系统", "模型"],
    "default": true
  }
}
```

### **badge-config.json**

```json
{
  "versionA": {
    "icon": "⚡️",
    "name": "灵动模式",
    "description": "精炼流畅，保持流动感",
    "color": "#FFD700"
  },
  "versionB": {
    "icon": "📋",
    "name": "结构模式",
    "description": "结构清晰，快速定位",
    "color": "#4169E1"
  },
  "versionC": {
    "icon": "🧠",
    "name": "深度无损模式",
    "description": "质量优先，语义保留 97%+",
    "color": "#9370DB"
  }
}
```

---

## 🧪 测试用例

### **测试 1：对话类文本 → 版本 A**

**输入：**
```
指挥官：Neo，你的信念有问题。
Neo：有问题？我一直觉得这个信念很好。
指挥官：这是一个负面的信息。
```

**预期路由：** 版本 A（⚡️ 灵动模式）

---

### **测试 2：数据报告 → 版本 B**

**输入：**
```
## 数据分析报告

### 1. 用户增长
- Q1: 10,000 用户
- Q2: 25,000 用户
- Q3: 50,000 用户

### 2. 收入统计
因此，总收入增长 150%。
```

**预期路由：** 版本 B（📋 结构模式）

---

### **测试 3：哲学理论 → 版本 C**

**输入：**
```
# UPTEF 框架核心概念

## 选择力
选择力是方向决策的能力，它决定我们做什么。

## 影响力
影响力是执行坍缩的能力，将意图变为现实。
```

**预期路由：** 版本 C（🧠 深度无损模式）

---

## 📊 路由日志

**日志格式：**
```
[时间] 输入长度 | 嗅探标签 | 路由版本 | 处理时间
[14:00:00] 1,234 chars | 对话 + 情感 | Version A | 0.3s
[14:05:00] 5,678 chars | 结构 + 数据 | Version B | 0.5s
[14:10:00] 12,345 chars | 知识 + 理论 | Version C | 1.2s
```

**日志用途：**
- 优化嗅探规则
- 分析用户习惯
- 改进路由准确率

---

## 🎯 成功指标

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| **路由准确率** | >95% | 用户反馈 + 人工抽查 |
| **响应时间** | <1 秒 | 日志记录 |
| **Token 节省** | 0 额外消耗 | 规则匹配，非 AI 判断 |
| **用户满意度** | >90% | 1-5 分评分 |
| **版本分布** | C:70% A:20% B:10% | 路由日志统计 |

---

## 🔄 迭代计划

### **v1.0（当前）**
- 基础路由逻辑
- 规则匹配嗅探
- 徽章显示

### **v1.1（2 周后）**
- 用户反馈收集
- 规则优化
- 准确率提升

### **v2.0（1 月后）**
- 机器学习优化（可选）
- 个性化路由偏好
- A/B 测试框架

---

## 🛡️ 安全边界

- 不存储用户原始文本（仅路由日志）
- 不上传云端（本地处理）
- 不分享路由数据（隐私保护）
- 用户可手动覆盖路由选择

---

## 📞 使用说明

**基本用法：**
```
/compress [文本或文件]
```

**手动指定版本：**
```
/compress --version=A [文本]
/compress --version=B [文本]
/compress --version=C [文本]
```

**查看路由日志：**
```
/router-logs --today
```

---

**技能状态：** ✅ 已创建  
**版本：** 1.0  
**下一步：** 实现 router.js 核心逻辑
